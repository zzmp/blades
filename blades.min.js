!function(e){function t(e){return e.length?e[e.length-1]:void 0}var o=function(e,o,n,r,a,s){var i,l=[];this.link=function(e){i=e},this.$bootstrap=function(){s.$bootstrap()};var p=function(e){e.element.remove(),e.scope.$destroy(),l.pop()};e.$on("blades:push",function(e,s,p){var c,u,d=t(l),f={name:s,scope:c=(d?d.scope:o).$new()};f.element=u=p?n(a.get(s))(c,null,r(p,{$scope:c})):n(a.get(s))(c),i.append(u),l.push(f),e.stopPropagation()}),e.$on("blades:pop",function(e){var o;(o=t(l))&&p(o),e.stopPropagation()}),e.$on("blades:emptyTo",function(e,o){for(var n;(n=t(l))&&n.name!==o;)p(n);e.stopPropagation()}),e.$on("blades:empty",function(e){for(var o;o=t(l);)p(o);e.stopPropagation()})};e.module("blades").controller("bladesController",["$rootScope","$scope","$compile","$controller","$templateCache","blades",o]);var n=function(){return{restrict:"EA",transclude:!1,replace:!0,template:'<div class="blades" />',controller:"bladesController",link:function(e,t,e,o){o.link(t),o.$bootstrap()}}},r=function(){return{require:"^blades",restrict:"E",transclude:!0,replace:!0,template:'<div class="blade" ng-transclude />'}};e.module("blades").directive("blades",n).directive("blade",r),e.module("blades",[]);var a=function(t,o,n,r,a,s){this.$bootstrap=function(){e.forEach(s,function(e){this.push(e)},this)},this.push=function(s){var i;if(!(i=a[s]))return void t(Error("Blade ["+s+"] is not registered."));var l=e.bind(o,o.$emit,"blades:push",s,i.controller);(template=r.get(s))?l():i.template?(r.put(s,i.template),l()):n.get(a[s].templateUrl).success(function(e){r.put(s,e),l()}).error(function(e){e.message="Blade ["+s+"] could not be retrieved from server.\n"+e.message,t(e)})},this.pop=function(){o.$emit("blades:pop")},this.emptyTo=function(e){o.$emit("blades:emptyTo",e)},this.empty=function(){o.$emit("blades:empty")}},s=function(){var t={},o=[];this.register=function(e,o){return t[e]=o,this},this.bootstrap=function(t){var n=e.bind(o,Array.prototype.push);e.isArray(t)?e.forEach(t,function(e){n(e)}):n(t)},this.$get=function(e,n,r,s){return new a(e,n,r,s,t,o)}};e.module("blades").provider("blades",s)}(angular);